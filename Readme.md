# Title: A Data-Driven Approach to Estimate and Mitigate the Effects of Curbside Pick-ups and Drop-offs on Traffic Congestion

Implemented by Xiaohui Liu (School of Computing, National University of Singapore), advised by Wei Ma (Civil and Environmental Engineering, The Hong Kong Polytechnic University).

# 1. Requirements

Detailed version and information of the packages can be found in "requirements.txt"

# 2. Dataset

| Data Sets | Time | Resolution| Amount| Description|
| ------ | ------ | ------ | ------ | ------ |
|NYC Traffic Speed| Feb 2019 - Jun 2020 | every 5 mins| 404,351,029| TMC, road speed, reference speed, time stamp|
|TCL Trip Record| Feb 2019 - Jun 2020 | every 5 mins|18,157,071|Pick-up region ID, drop-off region ID, time stamp|
|IEM | Feb 2019 - Jun 2020| every 1 hour| 11,987| Precipitation, time stamp|


# 3. Instructions

The repo contains two major components: DSML(Double and Separated Machine Learning) and Rerouting Programming.

## First, DSML includes cleaning data sets, training DSML, DML and LR models, and visualize estimation result.

*(1) Clean data sets:*

| Filename | Description | Details|
| ------ | ------ | ------ |
| speed.py | Redefine a relative average speed at regional level in every 5 min. | Merge the speed at the TMC (Traffic Message Channel) level into the regional level, and define the relative speed by considering reference speed. |
| triprecord.py | Count the number of PUDO（Pick-up/Drop-off）generated by green, yellow, FHV（For-Hire Vehicles） and HVFHV (High Volume For-Hire Vehicles) taxi at region level in every 5 min | Sum the number of pick-up and drop-off based on the trip record respectively. |
| speed_trip.py | Merge speed and PUDO number according to region ID and time | None |
| matrix.py | Fill up missed speed by KNN Imputer, and missed number of PUDO with 0 | Specifically, the parameters of filling in missed speed can be found in paras.py, measures.py and sensing.py ｜

*(2) Train models:*

dsml.py >> train DSML/ DML/ LR based on above cleaned data set. If you would like to train one of the three models, please pay attention to annotation and change the code manually.

*(3) Visualize \theta:*

visual_theta.py >> visualize estimation result of DSML, DML and LR respectively.

## Secondly, non-linear programming includes

*(1) Clean data sets:*

triprecord_for_optimization.py >> just count the number of drop-off in each 1 hour in regional level

*(2) Train models:*

| Filename | Description |
| ------ | ------ |
|optimization_DSML_functions.py | Functions of preparing data and recalculating value for the next iteration's optimization. |
|optimization_DSML_main.py | The main logic of solving the non-linear programming. |
|run_in_turns.py | Run optimization_DSML_main.py by inputting different parameters manually. It is convenient to run the code with different parameters at the same time, especially when we need make a sensitive analysis.|

*(3) Visualize improvement rate:*

please see ./Plot/visual_optimization_rate.py

## Additionally,

Visualization Code: ./Plot

| Filename | Description |
| ------ | ------ |
|plot2latex_correlation.ipynb|Make estimation result obtained by DSML, DML and LR into latex form; and calculate correlation coefficient among DSML(GB, RF, Ada), DML, and LR.|
|residual_analysis.ipynb|Plot residuals|
|visual_density.ipynb | Count density of \theta from DSML, DML and LR.|
|visual_location.py|Get folium map with taxi region ID|
|visual_location_ngbh.py | Get folium map with neighborhood regions|
|visual_optimization_rate.py |Calculate average improvement rate based on daily improvement rate; sensitivity analysis of controlling total vehicle amounts and rerouted vehicle amounts.|

# 4. Folder introduction:

| Filename | Description |
| ------ | ------ |
|./data_set|Collect all raw data|
|./mode_dml  | Store estimation result by DSML, DML and LR.|
|./Plot | Visualization|
|./Shortest_path | Store optimization result by the rerouting programming|
|./Others | Unuseful for paper, but may be meaningful for thinking about why these models present such result.

# 5. Slide

Please see the attached slide "DSML_Github.pdf", which presents this paper.

If you have any questions, please contact me (xiaohuiliu@u.nus.edu).